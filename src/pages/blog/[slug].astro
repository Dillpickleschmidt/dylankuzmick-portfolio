---
import { getCollection, render } from 'astro:content';
import Base from '../../layouts/Base.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content, headings } = await render(post);

// Filter to h2+ (skip h1 since that's the title)
const tocHeadings = headings.filter(h => h.depth >= 2 && h.depth <= 3);
---

<Base title={`${post.data.title} â€” Dylan Kuzmick`}>
	<article>
		<!-- Wide hero header -->
		<header class="max-w-6xl mx-auto px-6 pt-12 md:pt-20 pb-10">
			<a href="/blog" class="inline-flex items-center justify-center w-10 h-10 border border-[var(--color-border)] rounded hover:border-[var(--color-text-muted)] transition-colors duration-150 cursor-pointer mb-8">
				<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
			</a>
			<div class="grid grid-cols-1 md:grid-cols-[1fr_auto] gap-8 md:gap-12 items-end">
				<div>
					<h1 class="font-[family-name:var(--font-display)] text-[clamp(2.5rem,5vw,4rem)] leading-[1] tracking-tight">
						{post.data.title}
					</h1>
					<p class="text-[var(--color-text-muted)] mt-4 text-lg leading-relaxed max-w-2xl">{post.data.description}</p>
				</div>
				<!-- Placeholder image -->
				<div class="w-full md:w-64 aspect-[4/3] bg-[var(--color-surface)] flex items-center justify-center shrink-0">
					<span class="text-[var(--color-text-muted)] text-xs opacity-40">Image</span>
				</div>
			</div>

			<!-- Meta row -->
			<div class="flex items-center gap-6 mt-8 pt-6 border-t border-[var(--color-border)] text-xs uppercase tracking-[0.15em] text-[var(--color-text-muted)]">
				<time>{post.data.date}</time>
				<span class="w-1 h-1 rounded-full bg-[var(--color-text-muted)]"></span>
				<span>Dylan Kuzmick</span>
			</div>
		</header>

		<!-- Content + TOC layout -->
		<div class="max-w-6xl mx-auto px-6 pb-16">
			<div class="grid grid-cols-1 lg:grid-cols-[1fr_220px] gap-12 lg:gap-16">
				<!-- Main content -->
				<div class="prose max-w-3xl">
					<Content />
				</div>

				<!-- Table of Contents -->
				{tocHeadings.length > 0 && (
					<aside class="hidden lg:block">
						<nav class="sticky top-24">
							<h4 class="text-xs font-semibold uppercase tracking-[0.2em] text-[var(--color-text-muted)] mb-4">Contents</h4>
							<ul class="space-y-2.5">
								{tocHeadings.map(heading => (
									<li style={heading.depth === 3 ? 'padding-left: 0.75rem;' : ''}>
										<a
											href={`#${heading.slug}`}
											class="text-sm text-[var(--color-text-muted)] hover:text-[var(--color-accent)] transition-colors duration-150 cursor-pointer leading-snug block"
										>
											{heading.text}
										</a>
									</li>
								))}
							</ul>
						</nav>
					</aside>
				)}
			</div>
		</div>
	</article>
</Base>
