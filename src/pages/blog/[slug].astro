---
import { getCollection, render } from 'astro:content';
import Base from '../../layouts/Base.astro';
export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content, headings } = await render(post);

const tocHeadings = headings.filter(h => h.depth >= 2 && h.depth <= 3);
---

<Base title={`${post.data.title} â€” Dylan Kuzmick`}>
	<article>
		<!-- Header -->
		<header class="max-w-6xl mx-auto px-6 pt-12 md:pt-20 pb-10">
			<a href="/blog" class="group inline-flex items-center gap-2 font-mono text-xs uppercase tracking-[0.15em] text-text-muted/60 hover:text-accent transition-colors duration-200 mb-14 md:mb-16">
				<svg class="w-4 h-4 group-hover:-translate-x-0.5 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
				Back to blog
			</a>

			<div class="grid grid-cols-1 md:grid-cols-[1fr_auto] gap-8 md:gap-14 items-start">
				<div>
					<h1 class="font-serif text-[clamp(2.5rem,5vw,4rem)] leading-[1] tracking-tight font-semibold">
						{post.data.title}
					</h1>
					<p class="text-text-muted mt-4 text-lg leading-relaxed max-w-2xl">{post.data.description}</p>
				</div>
				{post.data.image && (
					<div class="w-full md:w-80 aspect-[16/10] rounded-lg bg-surface overflow-hidden shrink-0">
						<img src={post.data.image} alt="" class="w-full h-full object-cover" />
					</div>
				)}
			</div>

			<!-- Meta row -->
			<div class="flex items-center gap-4 mt-12 pt-6 border-t border-border/40 font-mono text-xs uppercase tracking-[0.08em] text-text-muted/60">
				<time>{post.data.date}</time>
				<span class="w-1 h-1 rounded-full bg-text-muted/40"></span>
				<span>Dylan Kuzmick</span>
			</div>
		</header>

		<!-- Content + TOC -->
		<div class="px-6 pb-20 md:pb-28">
			<div class="relative max-w-3xl mx-auto">
				<div class="prose">
					<Content />
				</div>

				{tocHeadings.length > 0 && (
					<aside class="hidden xl:block absolute top-0 left-full ml-10 w-[200px]">
						<nav class="sticky top-24">
							<h4 class="font-mono text-xs uppercase tracking-[0.15em] text-text-muted/50 mb-5">Contents</h4>
							<ul class="space-y-3">
								{tocHeadings.map(heading => (
									<li style={heading.depth === 3 ? 'padding-left: 0.75rem;' : ''}>
										<a
											href={`#${heading.slug}`}
											class="text-sm text-text-muted/50 hover:text-accent transition-colors duration-200 cursor-pointer leading-snug block border-l border-transparent hover:border-accent pl-3"
										>
											{heading.text}
										</a>
									</li>
								))}
							</ul>
						</nav>
					</aside>
				)}
			</div>
		</div>
	</article>
</Base>
