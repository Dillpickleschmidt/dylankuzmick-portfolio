---
import { getCollection, render } from 'astro:content';
import Base from '../../layouts/Base.astro';
export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content, headings } = await render(post);

// Filter to h2+ (skip h1 since that's the title)
const tocHeadings = headings.filter(h => h.depth >= 2 && h.depth <= 3);
---

<Base title={`${post.data.title} â€” Dylan Kuzmick`}>
	<article>
		<!-- Wide hero header -->
		<header class="max-w-6xl mx-auto px-6 pt-12 md:pt-20 pb-10">
			<a href="/blog" class="inline-flex items-center justify-center w-10 h-10 border border-border rounded hover:border-text-muted transition-colors duration-150 cursor-pointer mb-16">
				<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
			</a>
			<div class="grid grid-cols-1 md:grid-cols-[1fr_auto] gap-8 md:gap-12 items-start">
				<div>
					<h1 class="font-serif text-[clamp(2.5rem,5vw,4rem)] leading-[1] tracking-tight font-semibold">
						{post.data.title}
					</h1>
					<p class="text-text-muted mt-4 text-lg leading-relaxed max-w-2xl">{post.data.description}</p>
				</div>
				<div class="w-full md:w-80 aspect-[16/10] bg-surface overflow-hidden shrink-0 flex items-center justify-center">
					{post.data.image ? (
						<img src={post.data.image} alt="" class="w-full h-full object-cover" />
					) : (
						<span class="text-text-muted text-xs opacity-40">Image</span>
					)}
				</div>
			</div>

			<!-- Meta row -->
			<div class="font-mono flex items-center gap-6 mt-12 pt-6 border-t border-border text-sm font-light uppercase tracking-[0.08em] text-text-muted">
				<time>{post.data.date}</time>
				<span class="w-1 h-1 rounded-full bg-text-muted"></span>
				<span>Dylan Kuzmick</span>
			</div>
		</header>

		<!-- Content + TOC -->
		<div class="px-6 pb-16">
			<div class="relative max-w-3xl mx-auto">
				<div class="prose">
					<Content />
				</div>

				{tocHeadings.length > 0 && (
					<aside class="hidden xl:block absolute top-0 left-full ml-8 w-[200px]">
						<nav class="sticky top-24">
							<h4 class="font-mono text-sm font-light uppercase tracking-[0.08em] text-text-muted mb-4">Contents</h4>
							<ul class="space-y-4">
								{tocHeadings.map(heading => (
									<li style={heading.depth === 3 ? 'padding-left: 0.75rem;' : ''}>
										<a
											href={`#${heading.slug}`}
											class="text-[0.9375rem] font-normal text-text-muted hover:text-accent hover:translate-x-1 transition-all duration-200 cursor-pointer leading-tight block border-l-2 border-transparent hover:border-accent pl-3"
										>
											{heading.text}
										</a>
									</li>
								))}
							</ul>
						</nav>
					</aside>
				)}
			</div>
		</div>
	</article>
</Base>